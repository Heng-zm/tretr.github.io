<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapbox Responsive Map</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Mapbox CSS -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
    <!-- FontAwesome Icons CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    </style>
</head>
<body class="bg-gray-100">

    <div class="relative h-screen flex flex-col">
        <!-- Map -->
        <div id="map" class="flex-1"></div>

        <!-- Controls -->
        <div class="absolute z-10 bottom-0 left-0 right-0 flex flex-wrap items-center justify-around p-4 bg-white shadow-lg md:flex-col md:top-5 md:left-5 md:right-auto md:rounded-lg md:space-y-4">
            <!-- Existing Controls -->
            <button id="toggleStyle" class="bg-gray-500 text-white p-3 rounded-full shadow-lg hover:bg-gray-600 flex items-center justify-center">
                <i class="fas fa-satellite-dish text-lg"></i>
            </button>
            <button id="locateUser" class="bg-green-500 text-white p-3 rounded-full shadow-lg hover:bg-green-600 flex items-center justify-center">
                <i class="fas fa-map-marker-alt text-lg"></i>
            </button>

            <!-- New Buttons -->
            <button id="weatherBtn" class="bg-indigo-500 text-white p-3 rounded-full shadow-lg hover:bg-indigo-600 flex items-center justify-center">
                <i class="fas fa-cloud-sun text-lg"></i>
            </button>
            <button id="toggleTraffic" class="bg-red-500 text-white p-3 rounded-full shadow-lg hover:bg-red-600 flex items-center justify-center">
                <i class="fas fa-road text-lg"></i>
            </button>
        </div>
    </div>

    <!-- Mapbox JS -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <script>
        // Mapbox Access Token
        mapboxgl.accessToken = 'pk.eyJ1Ijoib3BlbnN0cmVldGNhbSIsImEiOiJja252Ymh4ZnIwNHdkMnd0ZzF5NDVmdnR5In0.dYxz3TzZPTPzd_ibMeGK2g';

        // Initialize the map
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/light-v10',
            center: [104.8797, 11.5441], // Phnom Penh coordinates
            zoom: 14.5,
            pitch: 45,
            bearing: 0
        });

        // Add navigation controls
        map.addControl(new mapboxgl.NavigationControl());

        let currentMarker;

        // Smooth Pan and Zoom Function
        const smoothPanAndZoom = (lng, lat, zoom) => {
            map.flyTo({
                center: [lng, lat],
                zoom: zoom,
                speed: 1.5,
                curve: 1,
                easing: (t) => t
            });
        };

        // Weather Functionality
        const weatherApiKey = 'ab2ecbf5875c30e16dea766ce80b8822';

        const fetchWeatherData = async (lng, lat) => {
            const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&units=metric&appid=${weatherApiKey}`);
            return response.json();
        };

        const showWeatherInfo = async () => {
            const { lng, lat } = map.getCenter();
            const weather = await fetchWeatherData(lng, lat);
            const weatherInfo = `
                <strong>Weather Information</strong><br>
                Temperature: ${weather.main.temp} Â°C<br>
                Wind Speed: ${weather.wind.speed} m/s<br>
                Conditions: ${weather.weather[0].description}
            `;
            const popup = new mapboxgl.Popup()
                .setLngLat([lng, lat])
                .setHTML(weatherInfo)
                .addTo(map);
        };

        document.getElementById('weatherBtn').addEventListener('click', showWeatherInfo);

        // Traffic Functionality
        let isTrafficEnabled = false;

        document.getElementById('toggleTraffic').addEventListener('click', function() {
            isTrafficEnabled = !isTrafficEnabled;
            map.setStyle(isTrafficEnabled 
                ? 'mapbox://styles/mapbox/traffic-day-v2' 
                : 'mapbox://styles/mapbox/light-v10');
        });
    </script>
</body>
</html>
